<script type="text/javascript" src="assets/js/jquery.min.js"></script>
<script type="text/javascript">
var clientArray = [
	{id: 1, last_updated: 12},
	{id: 2, last_updated: 15},
	{id: 3, last_updated: 9},
	{id: 5, last_updated: 12}
];

var serverArray = [
	{id: 1, last_updated: 12},
	{id: 2, last_updated: 20},
	{id: 3, last_updated: 10},
	{id: 4, last_updated: 15}
]
var DataCompare = {

	defaultOptions: {
		log: 1,
		idAttribute: "id",
		lastUpdatedAttribute: "last_updated"
	},

	check: function (clientArray, serverArray, options) {
		var clientCount = clientArray.length;
		var serverCount = serverArray.length;
		
		if (options != null) {
			options = $.extend(true, this.defaultOptions, options);
		} else {
			options = this.defaultOptions;
		}

		var idAttribute = options.idAttribute;
		var lastUpdatedAttribute = options.lastUpdatedAttribute;

		var addArray = [];
		var removeArray = [];
		var updateArray = [];

		
		if (this.log) {
			console.log("Client array: ", JSON.stringify(clientArray));
			console.log("Server array: ", JSON.stringify(serverArray));
		}

		for (var i = 0; i <= clientCount - 1; i ++) {
			var clientObject = clientArray[i];
			var clientId = clientObject[idAttribute];
			var found = false;

			// Run through the list to update and remove items
			for (var j = 0; j <= serverCount - 1; j++) {
				var serverObject = serverArray[j];
				var serverId = serverObject[idAttribute];

				if (clientId == serverId) {
					var clientLastUpdated = clientObject[lastUpdatedAttribute];
					var serverLastUpdated = serverObject[lastUpdatedAttribute];
					found = true;
					
					if (clientLastUpdated < serverLastUpdated) {
						// Update now!
						updateArray.push(clientId);
						if (this.log)
							console.log("Update: ", clientObject, serverObject);
					} else {
						// Unchanged
						if (this.log)
							console.log("Unchanged: ", clientObject, serverObject);
					}
				}
			}

			if (!found) {
				// Remove from client now!
				removeArray.push(clientId);
				if (this.log)
					console.log("Remove: ", clientObject);
			}
		}

		for (var i = 0; i <= serverCount - 1; i ++) {
			var serverObject = serverArray[i];
			var serverId = serverObject[idAttribute];
			var found = false;

			// Run through the list to update and remove items
			for (var j = 0; j <= clientCount - 1; j++) {
				var clientObject = clientArray[j];
				var clientId = clientObject[idAttribute];

				if (clientId == serverId) {
					found = true;
				}
			}

			if (!found) {
				// Add to client now!
				addArray.push(serverId);
				if (this.log)
					console.log("Add: ", serverObject);
			}
		}

		return {add: addArray, remove: removeArray, update: updateArray};
	}
}

console.log("Result: ", DataCompare.check(clientArray, serverArray));
/*
console.time("DataCompare");
for (var i = 0; i < 1000; i++) {
	DataCompare.check(clientArray, serverArray);
}
console.timeEnd("DataCompare");*/
</script>